<?xml version="1.0" encoding="UTF-8"?>

<!-- TODO remove this file in favor of Java code  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:cxf="http://cxf.apache.org/core"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:http="http://cxf.apache.org/transports/http/configuration"
       xmlns:sec="http://cxf.apache.org/configuration/security"
       xmlns:wsa="http://cxf.apache.org/ws/addressing"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd
                           http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
                           http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd
                           http://cxf.apache.org/configuration/security http://cxf.apache.org/schemas/configuration/security.xsd
                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

  <bean id="upvsSignatureCrypto" class="org.apache.wss4j.common.crypto.Merlin">
    <constructor-arg index="0">
      <util:properties>
        <prop key="org.apache.wss4j.crypto.merlin.keystore.file">${upvs.sts.keystore.file}</prop>
        <prop key="org.apache.wss4j.crypto.merlin.keystore.type">${upvs.sts.keystore.type}</prop>
        <prop key="org.apache.wss4j.crypto.merlin.keystore.alias">${upvs.sts.keystore.alias}</prop>
        <prop key="org.apache.wss4j.crypto.merlin.keystore.password">${upvs.sts.keystore.private.password}</prop>
      </util:properties>
    </constructor-arg>
    <constructor-arg index="1">
      <null />
    </constructor-arg>
    <constructor-arg index="2">
      <null />
    </constructor-arg>
  </bean>

  <bean id="upvsCallbackHandler" class="digital.slovensko.upvs.security.PasswordCallbackHandler">
    <constructor-arg index="0" value="${upvs.sts.keystore.alias}" />
    <constructor-arg index="1" value="${upvs.sts.keystore.private.password}" />
  </bean>

  <http:conduit name="{http://xmlns.oracle.com/sts/schema/sts-11g.xsd}wss11x509-port.http-conduit">
    <http:client ConnectionTimeout="${upvs.timeout.connection}" ReceiveTimeout="${upvs.timeout.receive}" />
    <http:tlsClientParameters>
      <sec:trustManagers>
        <sec:keyStore type="${upvs.tls.truststore.type}" password="${upvs.tls.truststore.password}" resource="${upvs.tls.truststore.file}" />
      </sec:trustManagers>
    </http:tlsClientParameters>
  </http:conduit>

  <bean id="stsClient" abstract="true" class="org.apache.cxf.ws.security.trust.STSClient">
    <constructor-arg ref="cxf" />
    <property name="location" value="${upvs.sts.address}" />
    <property name="wsdlLocation" value="sts/wss11x509.wsdl" />
    <property name="serviceName" value="{http://xmlns.oracle.com/sts/schema/sts-11g.xsd}wss11x509-serviceSoap12" />
    <property name="endpointName" value="{http://xmlns.oracle.com/sts/schema/sts-11g.xsd}wss11x509-port" />
    <property name="allowRenewing" value="false" />
    <property name="sendRenewing" value="false" />
    <property name="onBehalfOf" value="${upvs.sts.saml.assertion}" />
    <property name="properties">
      <map>
        <entry key="org.apache.cxf.message.Message.ENDPOINT_ADDRESS" value="${upvs.sts.address}" />
        <entry key="security.signature.crypto" value-ref="upvsSignatureCrypto" />
        <entry key="security.callback-handler" value-ref="upvsCallbackHandler" />
      </map>
    </property>
  </bean>
</beans>
